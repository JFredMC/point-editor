<div #map id="map" class="d-flex flex-column h-100 rounded shadow-sm"></div>

<div class="position-absolute top-0 start-50 translate-middle-x my-1">
  <div class="d-flex flex-wrap align-items-center gap-2">
    <div class="d-flex flex-wrap">
      <button 
          class="btn shadow-0 border-0 me-2 mb-2 d-flex align-items-center gap-2 py-1 px-2 py-md-2 px-md-3 btn-sm btn-md"
          [ngClass]="{'btn-primary': clickCoordinates() && !selectedFeature(), 'btn-transparent ': !clickCoordinates() || selectedFeature()}"
          (click)="showAddModal()"
          [disabled]="!clickCoordinates() || selectedFeature()"
          title="Add point at clicked location"
      >
          <i class="bi bi-plus-circle"></i>
      </button>
      <button 
          class="btn shadow-0 border-0 me-2 mb-2 d-flex align-items-center gap-2 py-1 px-2 py-md-2 px-md-3 btn-sm btn-md"
          [ngClass]="{'btn-info': selectedFeature(), 'btn-transparent': !selectedFeature()}"
          (click)="showEditModal()"
          [disabled]="!selectedFeature()"
          title="Edit selected point"
      >
          <i class="bi bi-pencil"></i>
      </button>
      <button 
          class="btn shadow-0 border-0 me-2 mb-2 d-flex align-items-center gap-2 py-1 px-2 py-md-2 px-md-3 btn-sm btn-md"
          [ngClass]="{'btn-danger': selectedFeature(), 'btn-transparent': !selectedFeature()}"
          (click)="deletePoint()"
          [disabled]="!selectedFeature()"
          title="Delete selected point"
      >
          <i class="bi bi-trash"></i>
      </button>
      <button 
          class="btn shadow-0 border-0 mb-2 d-flex align-items-center gap-2 py-2 px-3"
          [ngClass]="{'btn-warning': clickCoordinates(), 'btn-transparent': !clickCoordinates()}"
          (click)="clearSelection()"
          [disabled]="!clickCoordinates()"
          title="Clear selection"
      >
          <i class="bi bi-x-circle"></i>
      </button>
    </div>
    <app-search />
  </div>
</div>

@if (showModal()) {
  <app-point-form-modal 
    [data]="modalData()!"
    (save)="onSavePoint($event)"
    (cancel)="onCancelPoint()"
  />
}

<div class="position-absolute bottom-0 start-50 translate-middle-x mb-2 w-25 w-md-auto">
  <div class="card bg-light bg-opacity-90 shadow">
    <div class="card-body p-1 p-md-3">
      <div class="d-flex align-items-center gap-1 gap-md-2">
        <small class="text-muted fw-bold">Points: {{ features().length }}</small>
        
        @if (selectedFeature()) {
          <span class="badge bg-primary d-flex align-items-center gap-1 ms-2">
            <i [class]="getIconClassByCategory(selectedFeature()?.properties?.category)"></i>
            {{ selectedFeature()!.properties.name }}
          </span>
        } @else if (clickCoordinates()) {
          <span class="badge bg-success ms-2">
            <i class="bi bi-cursor"></i> Ready to add point
          </span>
        }
      </div>
    </div>
  </div>
</div>


<div class="position-absolute bottom-0 end-0 m-2">
  <div class="bg-dark bg-opacity-75 text-white py-1 rounded small px-2">
    © <a href="https://stadiamaps.com/" target="_blank" class="text-white text-decoration-none">Stadia Maps</a> 
    © <a href="https://openmaptiles.org/" target="_blank" class="text-white text-decoration-none">OpenMapTiles</a> 
    © <a href="https://www.openstreetmap.org/copyright" target="_blank" class="text-white text-decoration-none">OpenStreetMap</a> contributors
  </div>
</div>
